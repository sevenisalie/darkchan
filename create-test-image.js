const fs = require('fs');
const path = require('path');

// Create a minimal valid JPEG file for testing
// This creates a 1x1 pixel black JPEG image

// JPEG file structure (minimal)
const jpegData = Buffer.from([
  0xff, 0xd8, // SOI marker
  0xff, 0xe0, // APP0 marker
  0x00, 0x10, // Length of APP0 segment
  0x4a, 0x46, 0x49, 0x46, 0x00, // Identifier: "JFIF\0"
  0x01, 0x01, // Version: 1.1
  0x00, // Density units: no units, aspect ratio only
  0x00, 0x01, // X density: 1
  0x00, 0x01, // Y density: 1
  0x00, // Thumbnail width: 0
  0x00, // Thumbnail height: 0
  
  // Define quantization table
  0xff, 0xdb, // DQT marker
  0x00, 0x43, // Length: 67 bytes
  0x00, // Precision and table index
  // Quantization table (64 values)
  0x08, 0x06, 0x06, 0x07, 0x06, 0x05, 0x08, 0x07,
  0x07, 0x07, 0x09, 0x09, 0x08, 0x0a, 0x0c, 0x14,
  0x0d, 0x0c, 0x0b, 0x0b, 0x0c, 0x19, 0x12, 0x13,
  0x0f, 0x14, 0x1d, 0x1a, 0x1f, 0x1e, 0x1d, 0x1a,
  0x1c, 0x1c, 0x20, 0x24, 0x2e, 0x27, 0x20, 0x22,
  0x2c, 0x23, 0x1c, 0x1c, 0x28, 0x37, 0x29, 0x2c,
  0x30, 0x31, 0x34, 0x34, 0x34, 0x1f, 0x27, 0x39,
  0x3d, 0x38, 0x32, 0x3c, 0x2e, 0x33, 0x34, 0x32,
  
  // Start of frame
  0xff, 0xc0, // SOF0 marker
  0x00, 0x0b, // Length: 11 bytes
  0x08, // Precision: 8 bits
  0x00, 0x01, // Height: 1 pixel
  0x00, 0x01, // Width: 1 pixel
  0x01, // Number of components: 1 (grayscale)
  0x01, 0x11, 0x00, // Component parameters
  
  // Huffman table
  0xff, 0xc4, // DHT marker
  0x00, 0x1f, // Length: 31 bytes
  0x00, // Table info: DC, table id 0
  // Number of codes with length 1-16
  0x00, 0x01, 0x05, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  // Actual codes
  0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
  0x08, 0x09, 0x0a, 0x0b,
  
  // Another Huffman table
  0xff, 0xc4, // DHT marker
  0x00, 0x1f, // Length: 31 bytes
  0x10, // Table info: AC, table id 0
  // Number of codes with length 1-16
  0x00, 0x01, 0x05, 0x01, 0x01, 0x01, 0x01, 0x01,
  0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  // Actual codes
  0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
  0x08, 0x09, 0x0a, 0x0b,
  
  // Start of scan
  0xff, 0xda, // SOS marker
  0x00, 0x08, // Length: 8 bytes
  0x01, // Number of components: 1
  0x01, 0x00, // Component parameters
  0x00, 0x3f, 0x00, // Spectral selection
  
  // Image data (minimal compressed data)
  0x3f, 0x00,
  
  // End of image
  0xff, 0xd9
]);

// Save the JPEG file
const outputPath = path.join(__dirname, 'test-image.jpg');
fs.writeFileSync(outputPath, jpegData);

console.log(`Test image created at: ${outputPath}`);